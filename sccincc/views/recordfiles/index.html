<script type="text/javascript">
$(document).ready(function() {
var aoColumns=[
{ mData: "doymicac", sClass: "center",bSearchable: false,"bSortable": false },
               { mData: "filename", sClass: "center",bSearchable: false,"bSortable": false },
               	{ mData: "extname", sClass: "center",bSearchable: false,"bSortable": false },
               	{ mData: "filesize", sClass: "center",bSearchable: false,"bSortable": false },
               	{ mData: "associate", sClass: "center",bSearchable: false,"bSortable": false },
               	{ mData: "calltype", sClass: "center",bSearchable: false,"bSortable": false },
               	{ mData: "callnumber", sClass: "center",bSearchable: false,"bSortable": false },
               { mData: "cretime", sClass: "center" },
               
               { mData: "extennum", sClass: "center","bSortable": false  },
               
               	
                 { mData: "id", sClass: "center",bSearchable: false,"bSortable": false  }
                 
             ];
var where='';

var crtimefrom=$('#cretime_from').val();
    if(crtimefrom=='')
    	crtimefrom='2001-01-01 00:00:00';
    else
    	crtimefrom+=' 00:00:00';
var crtimeto=$('#cretime_to').val();
    if(crtimeto=='')
    	crtimeto='2099-12-31 23:59:59';
    	else
    	crtimeto+=' 23:59:59';
where+=',,,,,'+'cretime:::::between|||||'+crtimefrom+ '=====' + crtimeto;
//where+=',,,,,'+'cretime:::::lte|||||'+$('#cretime_to').val();


where+=',,,,,'+'doymicac:::::like|||||'+$('#doymicac').val();
where+=',,,,,'+'callnumber:::::like|||||'+$('#callnumber').val();

if(where!=='')
	where=where.replace(/^\,{5}/,'');

var daochu=[];
for(var i=0;i<aoColumns.length-1;i++){
	daochu[i]=i;	
}
$('#datatable').dataTable( {
	sDom: " <'row-fluid'<'span4'l><'span4'f><'span4'T>r>t<'row-fluid'<'span4'i><'span8 center'p>>",
	//sDom: 'T<"clear">lfrtip',
	sPaginationType: "bootstrap",
	//bDestroy:true,
	oLanguage: {
	sLengthMenu: "每页显示 _MENU_ 条记录",
    sZeroRecords: "对不起，查询不到任何相关数据",
    sInfo: "当前显示 _START_ 到 _END_ 条，共 _TOTAL_ 条记录",
    sInfoEmtpy: "找不到相关数据",
    //"sInfoFiltered": "数据表中共为 _MAX_ 条记录",  
    sProcessing: "正在加载中...",
    sSearch: "搜索",
    sInfoEmpty: "显示 0 至 0 共 0 项",
   oPaginate: { "sFirst": "第一页", "sPrevious": "上一页 ", "sNext": "下一页 ", "sLast": "末页 " }
	},
    bProcessing: true,
    bServerSide: true,
    bSort: true,
    bFilter:false,
    aaSorting: [[6, "desc"]],
    sAjaxSource: "/selectdb/pagingsearch?dbname=ippbx/recordfiles&cls=doymicac___filename___extname___filesize___associate___calltype___callnumber___cretime___extennum___id&where="+where,
    aoColumns:aoColumns ,
    aoColumnDefs: [
    {
    	aTargets: [0],
        mRender: function (data, type,full) {
                	   	return getagentname(data);
                	   }
    	
    },
                   
                	  {
                            	   aTargets: [aoColumns.length-1],
                            	
                                   mRender: function (data, type,full) {
                                	 var str='';            			           
               			            str+='<a href="javascript:play(\''+full.filename+'\');"><i class="icon-zoom-in icon-white"></i>播放</a>';
               			           
               			            return str;
                              
                               }
                	  }
                               //{bVisible:false,aTargets: [4]}
                              ],
                              oTableTools: {
             sSwfPath: "/css/swf/copy_csv_xls_pdf.swf",
             aButtons: [
                                 {
                 					"sExtends":    "collection",
                 					"sButtonText": '导出 <span class="caret" />',
                 					"aButtons":    [ "csv", "xls"],
                 					"mColumns": daochu
                 				}
                                
                                                   
                              ]
	}
	
  // "fnServerData": fnDataTablesPipeline
} );
} );


</script>

<script type="text/javascript">
function  play(src) {
    var filename='/SoundPlayer?filename='+src;
    $("#playerframeid").attr("src", filename);
    $("#showplayer").modal("show");       
    }
function delmut(){}
function del(ids){
	 $.ajax(
	            {
	                url: '/recordfiles/del',
	                dataType: 'json',
	                type: 'POST',
	                async: false,
	                data:{ids:ids},
	                success: function (data, textStatus) {	                    
		                    alert(data.msg);
		                    location.href='/recordfiles/';		                    
	                },
	                error: function (XMLHttpRequest, textStatus, errorThrown) {
	                    alert('服务器访问发生异常！' + textStatus);
	                    return;
	                }
	            }
	            );	
}
</script>


<script type="text/javascript">
	function getagentname(exten){
		var agents=<%= agents%>;
		return agents[exten]||exten;

	}
  $(function(){
    var agents=<%= agents%>;
    $("<option value='-1'  >请选择</option>").appendTo("#doymicac");  
    for(var key in agents){
      $("<option value='"+key+"'  >"+agents[key]+"</option>").appendTo("#doymicac");  
    }
    $("#doymicac").val("<%= where.doymicac%>");
  });
</script>
<div class="container-fluid">
<div id="mysearch" class="modal hide fade" tabindex="-1" role="dialog"
	aria-labelledby="myModalLabel" aria-hidden="true">
<div class="modal-header">
<button type="button" class="close" data-dismiss="modal"
	aria-hidden="true">×</button>
<h3 id="myModalLabel">按条件搜索</h3>
</div>
<div class="modal-body">
<div class="row-fluid sortable">
<div class="box span12">
<div class="box-content">
<form class="form-horizontal" method="POST">
<fieldset>           
<div class="control-group">
<label class="control-label" for="cretime">记录时间  从</label>
<div class="controls">
 <input type="text" class="input-xlarge datepicker" id="cretime_from" name="cretime_from" value="<%= where.cretime_from%>"> 
     </div>
</div>

<div class="control-group">
<label class="control-label" for="cretime">到</label>
<div class="controls">
<input type="text" class="input-xlarge datepicker" id="cretime_to" name="cretime_to" value="<%= where.cretime_to%>">
     </div>
</div>


<div class="control-group"><label class="control-label" for="doymicac">座席</label>
<div class="controls"><select id="doymicac" name="doymicac">
</select></div>
</div>

<div class="control-group"><label class="control-label" for="callnumber">关联号码 </label>
<div class="controls"> <input type="text" class="span6 typeahead" id="callnumber"
name="callnumber" value="<%= where.callnumber%>"> 
     </div>
</div>
     
<div class="modal-footer">
<button class="btn btn-small btn-danger" data-dismiss="modal"
	aria-hidden="true">关闭</button>
<button type="submit" class="btn btn-small btn-info">搜索</button>
</div>
</fieldset>
</form>
</div>
</div>
</div>
</div>

</div>


<div class="row-fluid sortable">
<div class="box span12">
<div class="box-content"> <a href="#mysearch"
	role="button" class="btn btn-small btn-primary" data-toggle="modal">
<i class="icon-search icon-white"></i>查询</a></div>

<div class="box-header well" data-original-title>
<h2><i class="icon-user"></i> 录音记录列表</h2>
<div class="box-icon"><a href="#"
	class="btn btn-minimize btn-round"><i class="icon-chevron-up"></i></a>

</div>
</div>
<div class="box-content">
<table class="table table-striped table-bordered bootstrap-datatable datatable" id="datatable">
	<caption></caption>
	<thead>
		<tr>
			<th>动态帐号</th>			 
			<th>文件名</th>			  
			<th>扩展名</th>			  
			<th>文件大小</th>			  
			<th>关联编号</th>			  
			<th>呼叫类型</th>
      <th>相关号码</th>
			<th>记录时间</th>			  
			<th>分机号</th> 
			<th>操作</th>
		</tr>
	</thead>
	<tbody>
	</tbody>
</table>
</div>
</div>
</div>
</div>

<div id="showplayer" class="modal hide fade" tabindex="-1" role="dialog"
	aria-labelledby="myModalLabel" aria-hidden="true">
<div class="modal-header">
<button type="button" class="close" data-dismiss="modal"
	aria-hidden="true">×</button>
<h3 id="myModalLabel">录音播放</h3>
</div>
<div class="modal-body">
<div class="row-fluid sortable">
<div class="box span12">
<div class="box-content">
<iframe id="playerframeid"></iframe>
</div>
</div>
</div>
</div>

</div>
