<script type="text/javascript"><!--
    $().ready(function () {

    });
      
        $(document).ready(function() 
          {
              //$('#Tip').hide();//显示操作提示的元素不可见
              $('#form1').submit(function()//提交表单
              {
                  //alert("ddd");
                  var options = { 
                //  target:'#Tip', //后台将把传递过来的值赋给该元素
                  url:'index', //提交给哪个执行
                  type:'POST', 
                  success: function(result,status){
                      if(result.success)
                      {
                      $("#savesuccess").click();
                      $("#id").val(result.id);
                      }
                      else
                      $("#saveerror").click();
                      } //显示操作提示
                  }; 
                  $('#form1').ajaxSubmit(options); 
                  return false; //为了不刷新页面,返回false，反正都已经在后台执行完了，没事！

                 

              });

            $('#submit').click(function(){
               // alert(11);
                $('#form1').submit();
                });  
          }
       );
  
   
    function startfaq(id) {
       
        parent.myLib.desktop.win.newWin({
            WindowTitle: '知识库',
            iframSrc: '/Faq?faqCodeId='+id,
            WindowsId: "_知识库",
            WindowAnimation: 'none',
            WindowWidth: 960,
            WindowHeight: 540
        });
    }
    
    function historyzx() {
        var customid = $("#id").val();
        if (customid == "") {
            alert("请先保存来电者信息！");
            return false;
        }
        parent.myLib.desktop.win.newWin({
            WindowTitle: '历史咨询',
            iframSrc: '/ConsultRecords?cID=' + customid,
            WindowsId: customid+"_历史咨询",
            WindowAnimation: 'none',
            WindowWidth: 960,
            WindowHeight: 540
        });

    }

    function historyyy() {
        var customid = $("#id").val();
        if (customid == "") {
           // alert("请先保存来电者信息！");
            //return false;
        }
        parent.myLib.desktop.win.newWin({
            WindowTitle: '商品档案',
            iframSrc: '/jzy/shopinfo',
            WindowsId: "dddd" + "_商品档案",
            WindowAnimation: 'none',
            WindowWidth: 960,
            WindowHeight: 540
        });
    }

    function historyts() {
        var customid = $("#id").val();
        var uphone=$("#phone").val();
        var uaddr=$("#lifeAddr").val();
        if (customid == "") {
            alert("请先保存来电者信息！");
            return false;
        }
        parent.myLib.desktop.win.newWin({
            WindowTitle: '历史投诉',
            iframSrc: '/ComplaintRecords?CustomID=' + customid,
            WindowsId: customid + "_历史投诉",
            WindowAnimation: 'none',
            WindowWidth: 960,
            WindowHeight: 540
        });

    }

    function addconsult(){
        var customid = $("#id").val();
        if (customid == "") {
            alert("请先保存来电者信息！");
            return false;
        }
        parent.myLib.desktop.win.newWin({
            WindowTitle: '新增来电：<%= callmsg.caller%>的咨询记录',
            iframSrc: '/ConsultRecords/create?unid=<%= callmsg.unid%>&customid=' + customid,
            WindowsId: "咨询记录_<%= callmsg.unid%>",
            WindowAnimation: 'none',
            WindowWidth: 960,
            WindowHeight: 540
        });
    }
    function addorder() {
        var customid = $("#id").val();
        var uphone=$("#phone").val();
        var uaddr=$("#lifeAddr").val();

        if (customid == "") {
            alert("请先保存来电者信息！");
            return false;
        }
        parent.myLib.desktop.win.newWin({
            WindowTitle: '新增来电：<%= callmsg.caller%>的工单记录',
            iframSrc: '/OrderRecords/create?unid=<%= callmsg.unid%>&customid=' + customid+'&uphone='+uphone+'&uaddr='+uaddr,
            WindowsId: "工单记录_<%= callmsg.unid%>",
            WindowAnimation: 'none',
            WindowWidth: 960,
            WindowHeight: 540
        });

    }

    function addts() {
        var customid = $("#id").val();
        if (customid == "") {
            alert("请先保存来电者信息！");
            return false;
        }
        parent.myLib.desktop.win.newWin({
            WindowTitle: '新增来电：<%= callmsg.caller%>的投诉建议记录',
            iframSrc: '/ComplaintRecords/create?unid=<%= callmsg.unid%>&customid=' + customid,
            WindowsId: "投诉建议记录_<%= callmsg.unid%>",
            WindowAnimation: 'none',
            WindowWidth: 960,
            WindowHeight: 540
                });

     

    }
</script>

<div class="row-fluid sortable">
<div class="box span12">
<div class="box-content"><a href="javascript:historyzx();"
	class="btn btn-small btn-primary"> <i class=" icon-edit icon-white"></i>历史来电</a>
<a href="javascript:historyyy();" role="button"
	class="btn btn-small btn-primary"> <i class="icon-tasks icon-white"></i>商品档案</a>
</div>
<div class="row-fluid sortable">
<div class="box span12">
<div class="box-header well">
<h2><i class="icon-th"></i> 基本信息</h2>
<div class="box-icon"><a href="#"
	class="btn btn-minimize btn-round"><i class="icon-chevron-up"></i></a>
</div>
</div>
</div>
<form class="form-horizontal" method="post" id="form1" name="form1">
<div class="box-content span6">
<div class="control-group"> <label class="control-label" for="Vip_name">客户姓名 </label>
<div class="controls"><input type="text" class="span12" id="Vip_name" name="Vip_name" value="<% if(inst!=null && typeof(inst.Vip_name)!=='object'){%><%=inst.Vip_name %><% }else{%><%}%>" /></div>
</div>
<div class="control-group"> <label class="control-label"
	for="Vip_sex">性别 </label>
<div class="controls"><input type="text" class="span12"
	id="Vip_sex" name="Vip_sex" value="<% if(inst!=null && typeof(inst.Vip_sex)!=='object'){%><%= inst.Vip_sex %><% }%>" /> </div>
</div>
<div class="control-group"> <label class="control-label"
	for="Company">单位名称 </label>
<div class="controls"><input type="text" class="span12"
	id="Company" name="Company" value="<% if(inst!=null && typeof(inst.Company)!=='object'){%><%= inst.Company %><% }%>" /> </div>
</div>

<div class="control-group"> <label class="control-label"
    for="phone">联系电话</label>
<div class="controls"><input type="text" class="span12" id="phone"
    name="phone" value="<% if(phone!=''){%><%= phone %><% }%>" /> </div>
</div>



</div>
<div class="box-content span6">
<div class="control-group"> <label class="control-label" for="Card_id">会员卡号</label>
<div class="controls"><input type="text" class="span12" id="Card_id"
    name="Card_id" value="<% if(inst!=null && typeof(inst.Card_id)!=='object'){%><%=
inst.Card_id %><% }%>" /> </div>
</div>



<div class="control-group"> <label class="control-label" for="CardName">卡名称
</label>
<div class="controls"><input type="text" class="span12" id="CardName"
	name="CardName" value="<% if(inst!=null && typeof(inst.CardName)!=='object'){%><%=
inst.CardName %><% }%>" /> </div>
</div>

<div class="control-group"> <label class="control-label" for="Discount">折扣
</label>
<div class="controls"><input type="text" class="span12" id="Discount"
    name="Discount" value="<% if(inst!=null && typeof(inst.Discount)!=='object'){%><%=
inst.Discount %><% }%>" /> </div>
</div>


<div class="control-group"> <label class="control-label"
    for="Jbr">经办人 </label>
<div class="controls"><textarea class="span12 autogrow"
    id="Jbr" name="Jbr"><% if(inst!=null && typeof(inst.Jbr)!=='object'){%><%= inst.Jbr %>   <% }%></textarea>
</div>
</div>

</div>
<div class="form-actions">
<button type="button" class="btn btn-primary" id="submit" name="submit">保存</button>
<button type="reset" class="btn">取消</button>
<button type="button" class="btn btn-primary" id="addyy" name="addyy" onclick="javascript:addyy();">添加已有</button>
</div>
</form>
<div style="display: none">
<button id="savesuccess" name="savesuccess" class="btn btn-primary noty"
	data-noty-options='{"text":"保存成功！","layout":"topCenter","type":"success","animateOpen": {"opacity": "show"}}'>
<i class="icon-bell icon-white"></i> Top Center (fade)</button>
<button id="saveerror" name="saveerrir" class="btn btn-primary noty"
	data-noty-options='{"text":"保存失败！","layout":"topCenter","type":"error"}'><i
	class="icon-bell icon-white"></i> Top Right</button>
</div>
</div>
<div class="box-content"><a href="javascript:addconsult();"
	class="btn btn-small btn-primary"> <i class="icon-edit icon-white"></i>新建来电</a>
    <!--
<a href="javascript:addorder();" role="button"
	class="btn btn-small btn-primary" data-toggle="modal"> <i
	class="icon-tasks icon-white"></i>新建工单</a> <a href="javascript:addts();"
	role="button" class="btn btn-small btn-primary" data-toggle="modal">
<i class="icon-leaf icon-white"></i>投诉建议</a>
-->
</div>
</div>
</div>

<div id="mysearch" class="modal hide fade" tabindex="-1" role="dialog"
    aria-labelledby="myModalLabel" aria-hidden="true">
<div class="modal-header">
<button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
</div>
<div class="modal-body">
<div class="row-fluid sortable">
<div class="box span12">
<div class="box-content">
<h3>符合条件的客户档案列表</h3>
<table id='selectcustom'> 
</table>
</div>
</div>
</div>
</div>

</div>


<script type="text/javascript">
function addyy(){
var where='';
where+='Vip_name='+$('#Vip_name').val();
where+='&'+'Card_id'+$('#Card_id').val();
where+='&'+'Jbr'+$('#Jbr').val();
   $.ajax(
                {
                    url: '/jzy/getCustoms?'+where,
                    dataType: 'json',
                    type: 'POST',
                    async: false,
                    data:{ids:ids},
                    success: function (data, textStatus) {                      
                            alert(data.aaData);
                            if(data.aaData.length>0){
                                $("#selectcustom").html('');
                                var str="<th>客户姓名</th><th>会员卡号</th><th>工作单位</th><th>操作</th>";
                                for(var i=0;i<data.aaData.length;i++){
                                    str+="<td>"+data.aaData[i].Vip_name+"</td>";
                                    str+="<td>"+data.aaData[i].Card_id+"</td>";
                                    str+="<td>"+data.aaData[i].Company+"</td>";
                                    str+="<td>"+<a href="javascript:setselect(var cus="+data.aaData[i]+");"></a>data.aaData[i].Vip_name+"</td>";

                                if(i==data.aaData.length){
                                   $("#selectcustom").html(str); 
                                   $('#mysearch').modal('show');
                                }

                                }


                            }
                            else{
                               alert("没有找到适合的客户档案。"); 
                            }                          
                    },
                    error: function (XMLHttpRequest, textStatus, errorThrown) {
                        alert('服务器访问发生异常！' + textStatus);
                        return;
                    }
                }
                );    
}

function setselect(data){
alert(data);
}
</script>




